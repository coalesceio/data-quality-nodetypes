fileVersion: 1
id: "448"
isDisabled: false
metadata:
  defaultStorageLocation: null
  error: null
  nodeMetadataSpec: |-
    capitalized: Advance Deploy DMFS
    short: DMFS
    tagColor: gray
    plural: Data Metric Functions
    deployStrategy: advanced

    config:

    - groupName: Scheduling Options
      items:
     
        # Way to schedule the task to run #
     
      - displayName: Schedule Options
        attributeName: schedulePeriodOption
        type: dropdownSelector
        default: Minutes
        options:
          - Minutes
          - CRON
          - TRIGGER_ON_CHANGES
        isRequired: true
     
      - displayName: Enter task schedule using minutes
        attributeName: schedulePeriod
        type: textBox
        default: '60'
        isRequired: false
        enableIf: "{% if config.schedulePeriodOption == 'Minutes' %} true {% else %} false {% endif %}"
     
      - displayName: Enter task schedule using CRON
        attributeName: scheduleCRON
        type: textBox
        placeholder: '5 0-23 * * * America/Los_Angeles'
        isRequired: false
        enableIf: "{% if config.schedulePeriodOption == 'CRON' %} true {% else %} false {% endif %}"

    - groupName: Universal DMFs
      items:

        # packageConfiguration - Edit package configuration to set default values #

      - type: toggleButton
        attributeName: universalDmfs
        displayName: 'Enable Universal DMFs'
        default: true
        isRequired: false

      - type: toggleButton
        attributeName: universalObjectDmfs
        displayName: 'Enable Universal Object Level DMFs'
        default: true
        isRequired: false
        enableIf: "{% if config.universalDmfs %} true {% else %} false {% endif %}"

      - displayName: Object Level DMFs List
        attributeName: universalObjectDmfsList
        type: textBox
        default: "
          -- This field is auto-populated from the Package Configuration.\n
          -- To edit, update the below Config\n
          packageConfiguration.universalObjectDmfs[]"
        isRequired: false
        syntax: sql
        enableIf: "{% if config.universalObjectDmfs and config.universalDmfs %} true {% else %} false {% endif %}"

      - type: toggleButton
        attributeName: universalColumnDmfs
        displayName: 'Enable Universal Column Level DMFs'
        default: true
        isRequired: false
        enableIf: "{% if config.universalDmfs %} true {% else %} false {% endif %}"

        #-------- Apply NULL_COUNT DMF to selected columns ---------#

      - type: toggleButton
        attributeName: universalColumnNullCountDMF
        displayName: 'Apply NULL_COUNT'
        default: true
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs %} true {% else %} false {% endif %}"

      - displayName: NULL_COUNT Column List
        attributeName: universalColumnNullCountDMFList
        type: textBox
        syntax: sql
        default: "
        -- This field is auto-populated from the Package Configuration.\n
        -- To edit, update the below Config in Package Configuration.\n
        packageConfiguration.nullCountUniversalColumns[]"
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs and config.universalColumnNullCountDMF %} true {% else %} false {% endif %}"

        #-------- Apply NULL_PERCENT DMF to selected columns --------#

      - type: toggleButton
        attributeName: universalColumnNullPercentDMF
        displayName: Apply NULL_PERCENT
        default: false
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs %} true {% else %} false {% endif %}"

      - displayName: NULL_PERCENT Column List
        attributeName: universalColumnNullPercentDMFList
        type: textBox
        syntax: sql
        default: "
        -- This field is auto-populated from the Package Configuration.\n
        -- To edit, update the below Config in Package Configuration.\n
        packageConfiguration.nullPercentUniversalColumns[]"
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs and config.universalColumnNullPercentDMF %} true {% else %} false {% endif %}"

        #-------- Apply BLANK_COUNT DMF to selected columns ---------#

      - type: toggleButton
        attributeName: universalColumnBlankCountDMF
        displayName: 'Apply BLANK_COUNT'
        default: false
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs %} true {% else %} false {% endif %}"

      - displayName: BLANK_COUNT Column List
        attributeName: universalColumnBlankCountDMFList
        type: textBox
        syntax: sql
        default: "
        -- This field is auto-populated from the Package Configuration.\n
        -- To edit, update the below Config in Package Configuration.\n
        packageConfiguration.blankCountUniversalColumns[]"
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs and config.universalColumnBlankCountDMF %} true {% else %} false {% endif %}"

        #-------- Apply BLANK_PERCENT DMF to selected columns --------#

      - type: toggleButton
        attributeName: universalColumnBlankPercentDMF
        displayName: Apply BLANK_PERCENT
        default: false
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs %} true {% else %} false {% endif %}"

      - displayName: BLANK_PERCENT Column List
        attributeName: universalColumnBlankPercentDMFList
        type: textBox
        syntax: sql
        default: "
        -- This field is auto-populated from the Package Configuration.\n
        -- To edit, update the below Config in Package Configuration.\n
        packageConfiguration.blankPercentUniversalColumns[]"
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs and config.universalColumnBlankPercentDMF %} true {% else %} false {% endif %}"

        #-------- Apply DUPLICATE_COUNT DMF to selected columns ---------#

      - type: toggleButton
        attributeName: universalColumnDuplicateCountDMF
        displayName: 'Apply DUPLICATE_COUNT'
        default: true
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs %} true {% else %} false {% endif %}"

      - displayName: DUPLICATE_COUNT Column List
        attributeName: universalColumnDuplicateCountDMFList
        type: textBox
        syntax: sql
        default: "
        -- This field is auto-populated from the Package Configuration.\n
        -- To edit, update the below Config in Package Configuration.\n
        packageConfiguration.duplicateCountUniversalColumns[]"
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs and config.universalColumnDuplicateCountDMF %} true {% else %} false {% endif %}"

        #-------- Apply UNIQUE_COUNT DMF to selected columns ---------#

      - type: toggleButton
        attributeName: universalColumnUniqueCountDMF
        displayName: 'Apply UNIQUE_COUNT'
        default: false
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs %} true {% else %} false {% endif %}"

      - displayName: UNIQUE_COUNT Column List
        attributeName: universalColumnUniqueCountDMFList
        type: textBox
        syntax: sql
        default: "
        -- This field is auto-populated from the Package Configuration.\n
        -- To edit, update the below Config in Package Configuration.\n
        packageConfiguration.uniqueCountUniversalColumns[]"
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs and config.universalColumnUniqueCountDMF %} true {% else %} false {% endif %}"

        #-------- Apply FRESHNESS  DMF to selected columns ---------#

      - type: toggleButton
        attributeName: universalColumnFreshnessDMF
        displayName: 'Apply FRESHNESS'
        default: true
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs %} true {% else %} false {% endif %}"

      - displayName: FRESHNESS  Column List
        attributeName: universalColumnFreshnessDMFList
        type: textBox
        syntax: sql
        default: "
        -- This field is auto-populated from the Package Configuration.\n
        -- To edit, update the below Config in Package Configuration.\n
        packageConfiguration.freshnessUniversalColumns[]"
        isRequired: false
        enableIf: "{% if config.universalDmfs and config.universalColumnDmfs and config.universalColumnFreshnessDMF %} true {% else %} false {% endif %}"

    - groupName: Object Level DMFs
      items:

      - type: toggleButton
        attributeName: addobjectleveldmfs
        displayName: 'Add Object Level DMFs'
        default: false
        isRequired: false

      - type: tabular
        displayName: 'DMF Functions'
        attributeName: adddmfsobject
        columns:

        - displayName: System DMFs
          attributeName: system_dmfs_object
          type: dropdownSelector
          default: "ROW_COUNT"
          options:
          - "ROW_COUNT"
          - "FRESHNESS"
          isRequired: false
          enableIf: "{% if config.addobjectleveldmfs %} true {% else %} false {% endif %}"

        isRequired: false
        enableIf: "{% if config.addobjectleveldmfs %} true {% else %} false {% endif %}"

    - groupName: Column Level DMFs
      items:

      - type: toggleButton
        attributeName: addcolumnleveldmfs
        displayName: 'Add Column Level DMFs'
        default: false
        isRequired: false

      - type: tabular
        displayName: 'DMF Functions'
        attributeName: adddmfs
        columns:

        - type: columnDropdownSelector
          displayName: Column Name
          attributeName: columnNameExpressions
          isRequired: false
          enableIf: "{% if config.addcolumnleveldmfs %} true {% else %} false {% endif %}"

        - displayName: System DMFs
          attributeName: system_dmfs
          type: dropdownSelector
          default: "NULL_COUNT"
          options:
            - "NULL_COUNT"
            - "NULL_PERCENT"
            - "BLANK_COUNT"
            - "BLANK_PERCENT"
            - "DUPLICATE_COUNT"
            - "UNIQUE_COUNT"
            - "FRESHNESS"
            - "AVG"
            - "MAX"
            - "MIN"
            - "STDDEV"
          isRequired: false
          enableIf: "{% if config.addcolumnleveldmfs %} true {% else %} false {% endif %}"

        isRequired: false
        enableIf: "{% if config.addcolumnleveldmfs %} true {% else %} false {% endif %}"

    - groupName: Custom DMFs
      items:

      - type: toggleButton
        attributeName: addCustomDMFs
        displayName: 'Add Custom DMFs'
        default: false
        isRequired: false

      - type: tabular
        displayName: 'CustomDMF Functions (Note: Use valid inputs to avoid errors)'
        attributeName: customDMFsConfig
        columns:

        - type: textBox
          displayName: Function Name
          attributeName: customDMFName
          syntax: sql
          default: ref('<storage_loc>', '<custom_dmf_name>')
          isRequired: false

        - type: textBox
          displayName: >
            Arguments (Note: Remove optional objects if not required)
          attributeName: customDMFArgs
          syntax: sql
          default: |
            - table (Required): 
                - column: <col_name1>
                - column: <col_name2>
                
            - table (Optional): {{ref('<storage_loc>', '<table_or_view_name>')}}
                - column: <col_name1>
                - column: <col_name2>
        isRequired: false
        enableIf: "{% if config.addCustomDMFs %} true {% else %} false {% endif %}"

    - groupName: Alerting Options
      items:
     
      - type: toggleButton
        attributeName: emailAlertToggle
        displayName: 'Enable Email Alert'
        default: false
        isRequired: false

      - type: label
        attributeName: paramLabel
        displayName: "âš  Note: Make sure the following parameters are defined in both the workspace and deployment environment - DMF_ALERT_INTEGRATION, DMF_ALERT_EMAIL, DMF_ALERT_WAREHOUSE, DMF_ALERT_SCHEDULE"
        enableIf: "{%- if config.overrideEmailAlertToggle == false and (parameters == {} or parameters.DMF_ALERT_INTEGRATION == '' or parameters.DMF_ALERT_EMAIL == '' or parameters.DMF_ALERT_WAREHOUSE == '' or parameters.DMF_ALERT_SCHEDULE == '') -%} true {%- else -%} false {%- endif -%}"

      - type: toggleButton
        attributeName: overrideEmailAlertToggle
        displayName: 'Enable Override Email Alert'
        default: false
        isRequired: false
        enableIf: "{% if config.emailAlertToggle %} true {% else %} false {% endif %}"

      - displayName: Alert Integration Name
        attributeName: notfIntegrationName
        type: textBox
        isRequired: false
        enableIf: "{% if config.emailAlertToggle and config.overrideEmailAlertToggle %} true {% else %} false {% endif %}"

      - displayName: Alert Warehouse Name
        attributeName: alertWarehouse
        type: textBox
        isRequired: false
        enableIf: "{% if config.emailAlertToggle and config.overrideEmailAlertToggle %} true {% else %} false {% endif %}"

      - displayName: Alert Frequency (Minutes)
        attributeName: alertFrequency
        type: textBox
        default: 60
        isRequired: false
        enableIf: "{% if config.emailAlertToggle and config.overrideEmailAlertToggle %} true {% else %} false {% endif %}"

      - displayName: Alert Email Recipient List(Ex. email1, email2)
        attributeName: emailList
        type: textBox
        isRequired: false
        enableIf: "{% if config.emailAlertToggle and config.overrideEmailAlertToggle %} true {% else %} false {% endif %}"

        # ------------- Trigger Configs - NULL ------------------------#

      - type: toggleButton
        attributeName: nullCntTrigger
        displayName: 'Trigger on NULL_COUNT (> 0)'
        default: true
        isRequired: false
        enableIf: "{% if config.emailAlertToggle %} true {% else %} false {% endif %}"

      - type: toggleButton
        attributeName: nullPrcntTrigger
        displayName: 'Trigger on NULL_PERCENT'
        default: false
        isRequired: false
        enableIf: "{% if config.emailAlertToggle %} true {% else %} false {% endif %}"

      - type: textBox
        attributeName: nullPrcntThreshold
        displayName: 'Null Percent Threshold (%)'
        default: 5
        isRequired: false
        enableIf: "{% if config.emailAlertToggle and config.nullPrcntTrigger %} true {% else %} false {% endif %}"

        # ------------- Trigger Configs - BLANK ------------------------#

      - type: toggleButton
        attributeName: blankCntTrigger
        displayName: 'Trigger on BLANK_COUNT (> 0)'
        default: false
        isRequired: false
        enableIf: "{% if config.emailAlertToggle %} true {% else %} false {% endif %}"

      - type: toggleButton
        attributeName: blankPrcntTrigger
        displayName: 'Trigger on BLANK_PERCENT'
        default: false
        isRequired: false
        enableIf: "{% if config.emailAlertToggle %} true {% else %} false {% endif %}"

      - type: textBox
        attributeName: blankPrcntThreshold
        displayName: 'BLANK_PERCENT Threshold (%)'
        default: 5
        isRequired: false
        enableIf: "{% if config.emailAlertToggle and config.blankPrcntTrigger %} true {% else %} false {% endif %}"

        # ------------- Trigger Configs - DUPLICATE ------------------------#

      - type: toggleButton
        attributeName: dupCntTrigger
        displayName: 'Trigger on DUPLICATE_COUNT (> 0)'
        default: true
        isRequired: false
        enableIf: "{% if config.emailAlertToggle %} true {% else %} false {% endif %}"

        # ------------- Trigger Configs - FRESHNESS ------------------------#

      - type: toggleButton
        attributeName: freshTrigger
        displayName: 'Trigger on FRESHNESS'
        default: true
        isRequired: false
        enableIf: "{% if config.emailAlertToggle %} true {% else %} false {% endif %}"

      - type: textBox
        attributeName: freshThreshold
        displayName: 'BLANK_PERCENT Threshold (Hours)'
        default: 24
        isRequired: false
        enableIf: "{% if config.emailAlertToggle and config.freshTrigger %} true {% else %} false {% endif %}"
name: DMFS
type: NodeType
